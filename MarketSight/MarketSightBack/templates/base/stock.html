{% load static tailwind_tags %}

<!DOCTYPE html>
<html lang="en">
<head>
   {% tailwind_css %}
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <link rel="stylesheet" href="{% static 'stock.css' %}">
   <title>{{ request.resolver_match.kwargs.stock_tick }}</title>
</head>

<body>

   <div class="navbar">

      <a href="{% url 'assistance' %}">Support</a>
      <a href="{% url 'room' %}">Portfolio</a>

      {% if user.is_authenticated %}
         <a href="{% url 'logout_page' %}">Logout</a>
      {% else %}
         <a href="{% url 'login' %}">Login</a>
      {% endif %}

      <a href="{% url 'search' %}">Search</a>
   </div>

 

   <div class="stock">
      {% for stocks in ticker %}
         <div>
            <p>{{ stocks.id }}: {{ stocks.stock }}</p>
         </div>
      {% endfor %}
   </div>

   <!-- removed extra stray </div> here -->
   
   <section class="stock-orders flex flex-col py-6 gap-2">
      <div class="stockPrice flex flex-col gap-3 py-6 bg-transparent items-start justify-start content-start">
         <!-- Grab exchangeName -->
          <span class="text-gray-200 text-[12px]"></span>
         <!-- Ticker Name, and I want company name beside it -->
         <h2 class="text-gray-200  font-bold  text-[23px] ">{{longName | safe}}   ({{request.resolver_match.kwargs.stock_tick}})</h2>
         <!-- Stock price -->
         <h3 class="livePrice text-white font-bold text-[23px]"></h3>
         <!-- The Data Label. -->
          <p class="text-gray-200 font-bold text-[20px]">As of right now at {{date | safe}} UTC</p>

         <!-- Have the Bullish chart here -->

      <!-- Wrapper for the div of Bullish indicator and Stock Graph to get it hrizontal -->
      <div class="stock-orders flex flex-row gap-4">
     

         <div class="stock_graph relative h-[500px] w-2/3 mx-auto border-2 border-cyan-300 shadow-[0_0_15px_rgba(34,211,238,0.8),inset_0_0_15px_rgba(34,211,238,0.5)] ">
            <canvas id="stockGraph"></canvas>
         </div>

         
         <div class="bullish_circle flex items-center justify-center h-[500px] w-1/3 border-2 border-cyan-300 shadow-[0_0_15px_rgba(34,211,238,0.8),inset_0_0_15px_rgba(34,211,238,0.5)]">
         <canvas id="bullishIndicator" class="w-full h-full"></canvas>

         </div>

         <div class="capm_cicle flex items-center justify-center h-[500px] w-1/3 border-2 border-cyan-300 shadow-[0_0_15px_rgba(34,211,238,0.8),inset_0_0_15px_rgba(34,211,238,0.5)]">
         <canvas id="capmGraph" class="w-full h-full"></canvas>

         </div>

      </div>

      <div>
         <button class="interval bg-blue-500 hover:bg-blue-300 hover:text-white"
                 data-interval="1D">1D</button>

         <button class="interval  text-gray-950 hover:bg-blue-300 hover:text-white"
                 data-interval="1W">1W</button>

         <button class="interval  text-gray-950 hover:bg-blue-300 hover:text-white"
                 data-interval="1M">1M</button>

         <button class="interval  text-gray-950 hover:bg-blue-300 hover:text-white"
                 data-interval="1Y">1Y</button>
      </div>


      <!-- Stock order -->
      {% if user.is_authenticated %}
       <!-- Wrapper, create a glowing broder -->
       <div class="flex border-cyan-300 shadow-[0_0_15px_rgba(34,211,238,0.8),inset_0_0_15px_rgba(34,211,238,0.5)] w-full max-w-[400px] items-center justify-center gap-4 mt-4">

         <form method="POST" class="w-full" id="form_execute" action="/trade/{{ request.resolver_match.kwargs.stock_tick }}/BUY/"  class="w-full max-w-[420px] flex flex-col items-center text-center gap-4">
            {% csrf_token %}
            <!-- Button wrapper -->
            <div class="flex w-full gap-4">
               <button class="bg-blue-400 text-white text-[24px] border-r-4 border-none w-1/2 hover:bg-blue-800 transition-colors hover:text-blue-500 " id="buy-button" >BUY</button>
               <button class="bg-blue-700 text-gray-500 text-[24px] border-r-4 border-none w-1/2 hover:bg-blue-800 transition-colors hover:text-blue-500 " id="sell-button">SELL</button>
            </div>
            <!-- Input  -->
            <div class="flex flex-col">
               <!-- Change it via JS -->
                <!-- What we want: B-->
               <p class="text-white text-center text-[24px] font-bold" id="text-changer">
                  Buy some {{request.resolver_match.kwargs.stock_tick}}
               </p>
               <div class="text-white mt-4 p-4   rounded">
                  
                  <p id="total-cost"><strong id="strong-changer-total">Total Cost:</strong> $0.00</p>

                  {% if shares_owned > 0 %}
                  <p><strong>Shares Owned:</strong> {{ shares_owned }}</p>
                  <p id="total-return"><strong>Total Return:</strong> {{ shares_owned }}</p>
                  <p><strong>Average Cost:</strong> ${{ avg_cost }}</p>
                  {% endif %}


               </div>

            <input type="text" id="input-changer" min='0' name="input-changer" placeholder="Buy some {{request.resolver_match.kwargs.stock_tick}}" 
            class="px-4 py-2 text-black bg-white rounded-md focus:outline-none border-4" autocomplete="off">
            
            <button type="submit" id="button-execute" class="bg-blue-600 border-4 w-full text-white text-[12px]">BUY</button>
            <button type="button" id="button-max" class="bg-blue-600 border-4 w-full text-white text-[12px] mt-2">MAX</button>

         {% else %}
         <a href="{% url 'login' %}"> 
         <p>Please Login to take advantage of our tools!. We welcome you to MarketSight, a pathway for strategic decisions, and summarized reports for you!</p> 
         </a>
  

         {% endif %}


               

               <!-- Input for  -->


      


            </div>
         </form>

       </div>

      <!-- Half the width by 50%  -->
      

   </section>

   <section class="max-w-7xl mx-auto px-6 py-8 items-center mt-3">
      <div class="grid grid-cols-1 md:grid-cols-2 sm:grid-cols-3 gap-6">

         {% for title, content in information_of_stock.items %}
            <!-- Conn -->
            <div class="flexcard group rounded-lg bg-blue-800 shadow text-center hover:bg-blue-300 transition-transform duration-300 hover:scale-105">

               <h3 class="text-lg font-bold mb-4 text-white group-hover:text-blue-950 duration-300">
                  {{ title }}
               </h3>

               <div class="gen-ai text-white group-hover:text-blue-950 space-y-4 leading-relaxed duration-300">
                  {{ content|linebreaks }}
               </div>

            </div>

         {% endfor %}

      </div>
   </section>

   <div class="stock_news">
      <!-- news goes here -->
   </div>

   <!-- scripts -->
   {% block scripts %}

   <script>
   const stockTicker = "{{ request.resolver_match.kwargs.stock_tick }}";
   const chartLabels = {{ stock_graph|safe }};
   const chartPrices = {{ stock_price|safe }};
   const points = {{bullish_indicator | safe}};
   const scoreOfCapm = {{capm_score_of_stock | safe}};
   const Chart_yesterday_price = {{yesterday_price | safe}};
      // Should be last, as it reliant on if the user owns the stock or not
   const user_capital = {{capital | safe}};
   const average_cost = {{avg_cost | safe}};
   const shares = {{shares_owned | safe}};



   </script>
   <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
   <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
   <script src="https://cdn.jsdelivr.net/npm/gsap@3.14.1/dist/gsap.min.js"></script>
   <script src="{% static 'stock.js' %}"></script>



   {% endblock scripts %}
   

</body>
</html>
